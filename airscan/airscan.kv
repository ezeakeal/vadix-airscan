#:kivy 1.0
#:import kivy kivy
#:import win kivy.core.window
#:import WipeTransition kivy.uix.screenmanager.SlideTransition
#:import CheckBox kivy.uix.checkbox
#:import webbrowser webbrowser

ScreenManagement:
    transition: WipeTransition()
	MainScreen:
    ScanScreen:
    ResultScreen:

<MainScreen>:
    name: "main"
    canvas:
        Color:
            rgb: 1,1,1
        Rectangle:
            source: "assets/background.png"
            size: self.size

    Image:
        size_hint: 0.5, 0.5
        source: 'assets/vadix_logo.png'
        pos_hint: {'center_x':.85, 'center_y':.2}
    
    BoxLayout:
        padding: 10
        spacing: 10
        size_hint: 0.8, None
        pos_hint: {'top': 0.7, 'center_x': 0.5}
        height: 44
        Label:
            text_size: self.width, None
            halign: 'center'
            font_size: 26
            color: (1, 1, 1, .8)
            text: 'Please ensure you are connected to the host\'s WiFi network before beginning the scan!'

    Button:
        size_hint: 0.5, 0.2
        pos_hint: {'center_x':.5, 'center_y':.4}
        on_release: app.root.current = "scanning"
        # on_release: app.root.current = "result"
        text: "Begin Scan"
        font_size: 50

    BoxLayout:
        padding: 10
        spacing: 10
        size_hint: 0.8, None
        pos_hint: {'top': 0.2, 'center_x': 0.5}
        height: 44
        Label:
            text_size: self.width, None
            halign: 'center'
            font_size: 14
            color: (1, 1, 1, .8)
            text: 'This application must not be used in any way which is unlawful, illegal, fraudulent or harmful, or in connection with any unlawful, illegal, fraudulent or harmful purpose or activity.'


<ScanScreen>:
    name: "scanning"
    canvas:
        Color:
            rgb: 1,1,1
        Rectangle:
            source: "assets/background.png"
            size: self.size

    Image:
        size_hint: 0.5, 0.5
        source: 'assets/vadix_logo.png'
        pos_hint: {'center_x':.85, 'center_y':.2}

    BoxLayout:
        size_hint: 0.5, 0.5
        pos_hint: {'center_x':.5, 'center_y':.55}
        Label:
            id: status_label
            font_size: 20
            height: 24
            text_size: self.width, None
            color: (1, 1, 1, .8)
            text: 'Beginning scan pipeline..'

    ProgressBar:
        id: progress_bar
        max: 100
        value: 0
        height: '10dp'
        size_hint: (0.6, 0.6)
        pos_hint: {'center_x':.5, 'center_y':.5}
    
   

<ResultScreen>:
    name: "result"

    canvas:
        Color:
            rgb: 1,1,1
        Rectangle:
            source: "assets/background.png"
            size: self.size
    Image:
        size_hint: 0.5, 0.5
        source: 'assets/vadix_logo.png'
        pos_hint: {'center_x':.85, 'center_y':.2}
        
    BoxLayout:
        size_hint: 0.9, 0.08
        pos_hint: {'center_x':.5, 'center_y':.954}
        opacity: 0
        BoxLayout:
            orientation: "vertical"
            Label: 
                height: 16
                color: (1, 1, 1, .8)
                text: 'Raw Report (advanced)'
            CheckBox:
                size: self.width, 24
                on_press: root.isShownMenu = not root.isShownMenu

        Button:
            size_hint: 0.9, 0.75
            pos_hint: {'center_x':.25, 'center_y':.5}
            on_release: app.root.current = "main"
            text: "Perform new scan"
            font_size: 20

    BoxLayout:
        id: advanced_box
        size_hint: 0.9, 0.9
        pos_hint: {'center_x':.5, 'center_y':.46}
        width:   0 if root.isShownMenu else 0.9
        opacity: 0 if root.isShownMenu else 1
        CodeInput:
            id: result_panel

    BoxLayout:
        orientation: "vertical"
        id: default_box
        size_hint: 0.9, 0.85
        pos_hint: {'center_x':.5, 'top': 0.85}
        opacity: 1
        spacing: 30
        
        BoxLayout:
            orientation: "horizontal"
            size_hint: 1.0, 0.5
            pos_hint: {'center_x':.5, 'top':.9}

            BoxLayout:
                orientation: "vertical"
                opacity: 1.0 if root.atRisk else 0.05
                
                Image:
                    id: summary_image
                    size_hint: 1.0, 0.4
                    source: 'assets/danger.png'
                    pos_hint: {'center_x':.5, 'top':.3}
                
                Label:
                    id: summary_string
                    font_size: 40
                    size_hint: 1.0, 0.3
                    color: (1, 1, 1, .8)
                    text: 'You are at risk.'
                
                Button:
                    font_size: 16
                    size_hint: 0.8, 0.15
                    pos_hint: {'center_x':.5}
                    text: 'Click for more information..'
                    on_release: webbrowser.open("http://blog.vadix.io/2019/04/08/airscan/")
                
            BoxLayout:
                orientation: "vertical"
                opacity: 0.05 if root.atRisk else 1.0

                Image:
                    id: summary_image
                    size_hint: 1.0, 0.5
                    source: 'assets/success.png'
                    pos_hint: {'center_x':.5, 'top':.3}
                Label:
                    id: summary_string
                    size_hint: 1.0, 0.3
                    font_size: 40
                    color: (1, 1, 1, .8)
                    text: 'You are not at risk.'

        GridLayout:
            id: summary_grid
            cols: 5
            row_force_default: True
            row_default_height: 40
    



